#!/usr/bin/env bash


echo "pwd: $PWD"




ls -la .

ls -la /
echo "ls -la /bin"
ls -la /bin

ls ./.heroku

if [ -f ./.heroku/data ]; then
  ls ./.heroku/data
fi

echo "1: $1"
echo "2: $2"
echo "3: $3"


if [ -f bin/post_compile ]; then
    echo "-----> Running post-compile hook"
    chmod +x bin/post_compile
    sub_env bin/post_compile
fi




BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3



for file in "$ENV_DIR"/*
do
  [[ -f "$file" ]] || continue
  var="${file##*/}"
  if
    printf -v "$var" "$(<"$file")" 2>/dev/null
  then
    export "$var"
  else
    echo "Invalid filename: $file"
  fi
done

/app/.heroku/python/bin/python heroku_buildpack.py

echo "HERE ls -la ."
ls -la .
echo "destination is $CACHE_DIR/.heroku/data/processed_data.pkl"

mkdir -p $CACHE_DIR/.heroku/data
cp $BUILD_DIR/data/processed_data.pkl "$CACHE_DIR/.heroku/data/processed_data.pkl"
echo "ls $CACHE_DIR/.heroku/data"
ls $CACHE_DIR/.heroku/data